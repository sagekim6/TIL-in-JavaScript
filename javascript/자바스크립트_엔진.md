# 자바스크립트 엔진

## 메모리 힙(memory heap)

<u>메모리 할당이 일어나는 부분이다.</u> 변수, 객체 등이 저장되는 일종의 창고다.

## 호출 스텍(call stack)

함수가 호출되는 순서대로 쌓이는 스택이다.  
함수 실행 시 호출 스택에 해당 함수를 집어넣고 return 시(함수의 실행이 끝나면) 호출 스택의 맨 위에 있는 해당 함수를 끄집어낸다.

- 자바스크립트는 하나의 호출 스텍을 가진다.  
  &rarr; 호출 스택을 하나만 사용하기 때문에 자바스크립트는 싱글 스레드 언어라고 한다. **즉, 동시에 하나의 일만 처리할 수 있다.**
- 프로그램이 실행되면 **제일 먼저 `main context`가 호출 스택에 쌓이고**  
  그 위에 다른 여러 스택이 쌓이고 없어지기를 반복한다. 만약 프로그램의 실행이 완료되면 `main context`도 같이 종료된다.

## 브라우저(Web Browser)의 구조

자바스크립트 엔진(메모리 힘과 호출 스택)과 브라우저와 함께 비동기 처리를 지원한다.  
자바스크립트 엔진은 싱글 스레드로 하나의 일만 처리하지만 실제로 자바스크립트가 구동되는 웹 브라우저에는 여러개의 스레드가 사용된다.

### Web APIs

- 비동기로 처리되어야할 함수는 Web APIs로 넘겨지고 처리가 완료된 후 실행되어야 할 콜백함수는 콜백 큐(Callback Queue)로 넘겨진다.

### Callback Queue(= Task Queue)

- Web APIs의 **콜백 함수들이 대기하는 큐**
- 콜백 큐에 있는 콜백 함수들도 함수이기 때문에 실행이 되려면 호출 스택에 들어가야하는데 그 전까지 대기하는 공간이다.

### 이벤트 루프(Event Loop)

- 이벤트 루프는 호출 스택과 콜백 큐를 계속 주시하다가 호출 스택이 비어있으면,  
  먼저 들어온 순서대로 콜백 큐에 있는 콜백 함수들을 호출 스택으로 집어넣는다.
- 호출 스택이 비어있어야만 콜백 함수가 호출 스택으로 이동할 수 있다.

  <img src="https://images.velog.io/images/gwanuuoo/post/d77bd91c-35ad-45c7-b48a-bb90c006d74a/1_4lHHyfEhVB0LnQ3HlhSs8g.png" alt="자바스크립트 엔진" width="60%" height="60%">
